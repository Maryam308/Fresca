<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Recipe - Fresca</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link rel="stylesheet" href="/stylesheets/addEditRecipe.css" />
    <script src="/scripts/recipeValidation.js"></script>

  </head>
  <body>
    <%- include('../partials/_navbar.ejs') %>
        <section class="hero">
      <div class="container">
        <div class="hero-content">
         <h1>Edit Recipe</h1>
        <p>Update your delicious recipe</p>
        </div>
      </div>
    </section>
    <br>
    <div class="container">
      <div class="form-container">
        <form action="/recipes/<%= recipe._id %>?_method=PUT" method="POST" enctype="multipart/form-data">
          <div class="form-group">
            <label for="title">Recipe Title *</label>
            <input 
              type="text" 
              id="title" 
              name="title" 
              value="<%= recipe.title %>"
              placeholder="Enter a delicious recipe name"
              required 
            />
          </div>

          <div class="form-group">
            <label for="cuisineId">Cuisine Category</label>
            <select id="cuisineId" name="cuisineId">
              <option value="">-- Select Cuisine Type --</option>
              <% if (cuisines && cuisines.length > 0) { %>
                <% cuisines.forEach(cuisine => { %>
                  <option value="<%= cuisine._id %>" 
                    <%= recipe.cuisineId && recipe.cuisineId._id.toString() === cuisine._id.toString() ? 'selected' : '' %>>
                    <%= cuisine.cuisineName %>
                  </option>
                <% }) %>
              <% } %>
            </select>
          </div>

          <% if (recipe.recipeImage) { %>
          <div class="form-group">
            <label>Current Recipe Image</label>
            <div class="current-image-container">
              <img src="<%= recipe.recipeImage %>" alt="Current recipe image" class="current-recipe-image" />
            </div>
          </div>
          <% } %>

          <div class="form-group">
            <label for="recipeImage">Update Recipe Image</label>
            <input
              type="file"
              id="recipeImage"
              name="recipeImage"
              accept=".png,.jpg,.jpeg"
              />
            <small class="form-help">Leave empty to keep current image</small>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="prepTime">Prep Time (minutes) *</label>
              <input 
                type="number" 
                id="prepTime" 
                name="prepTime" 
                value="<%= recipe.prepTime %>"
                min="0" 
                placeholder="15"
                required 
              />
            </div>

            <div class="form-group">
              <label for="cookTime">Cook Time (minutes) *</label>
              <input 
                type="number" 
                id="cookTime" 
                name="cookTime" 
                value="<%= recipe.cookTime %>"
                min="0" 
                placeholder="30"
                required 
              />
            </div>
          </div>

          <div class="form-group">
            <label>Ingredients *</label>
            <div id="ingredients-container" class="ingredients-container">
              <% if (recipe.ingredients && recipe.ingredients.length > 0) { %>
<% recipe.ingredients.forEach(ingredient => { %>
  <div class="ingredient-field">
    <input
      type="text"
      name="ingredients[]"
      value="<%= ingredient %>"
      placeholder="e.g., 1 cup all-purpose flour"
      required
    />
  </div>
<% }) %>

              <% } else { %>
                <div class="ingredient-field">
                  <input
                    type="text"
                    name="ingredients[]"
                    placeholder="e.g., 1 cup all-purpose flour"
                    required
                  />
                </div>
              <% } %>
            </div>
            <button type="button" class="btn-add" onclick="addInput('ingredients')">
              Add another ingredient
            </button>
          </div>

          <div class="form-group">
            <label>Cooking Steps *</label>
            <div id="steps-container" class="steps-container">
              <% if (recipe.steps && recipe.steps.length > 0) { %>
    <% recipe.steps.forEach(step => { %>
  <div class="step-field">
    <textarea
      name="steps[]"
      placeholder="Describe the cooking step in detail..."
      required
    ><%= step %></textarea>
  </div>
<% }) %>

              <% } else { %>
                <div class="step-field">
                  <textarea
                    name="steps[]"
                    placeholder="Describe the first step in detail..."
                    required
                  ></textarea>
                </div>
              <% } %>
            </div>
            <button type="button" class="btn-add" onclick="addInput('steps')">
              Add another step
            </button>
          </div>

          <div class="form-actions">
            <a href="/recipes/<%= recipe._id %>" class="btn-secondary">← Cancel</a>
            <button type="submit" class="btn-submit">
              Update Recipe
            </button>
          </div>
        </form>
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <a href="#top" class="back-to-top">↑</a>
        <p>&copy; All rights reserved Fresca 2025</p>
      </div>
    </footer>
  </body>
</html>