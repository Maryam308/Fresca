<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipes - Fresca</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script>
      const currentUserId =
        "<%= currentUser ? currentUser._id.toString() : '' %>";
    </script>
    <script src="/scripts/script.js"></script>

    <script src="/scripts/script.js"></script>
  </head>
  <body>
    <%- include('../partials/_navbar.ejs') %>
    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <div class="hero-content">
          <h1>Let's Get Into Cooking</h1>
          <a href="/recipes/new" class="add-recipe-btn">Add a new Recipe</a>
        </div>
      </div>
    </section>

    <!-- Filter Section -->
    <section class="filter-section">
      <div class="container">
        <h2 class="filter-title">
          What to <span class="highlight">Cook?</span>
        </h2>

        <div class="category-filters">
          <button class="filter-btn active" data-category="all">
            All Cuisines
          </button>
          <% if (cuisines && cuisines.length > 0) { %> <%
          cuisines.forEach(cuisine => { %>
          <button
            class="filter-btn"
            data-category="<%= cuisine.cuisineName.toLowerCase() %>"
          >
            <%= cuisine.cuisineName %>
          </button>
          <% }) %> <% } %>
        </div>

        <% if (currentUser) { %>
        <div class="recipe-toggle">
          <button class="toggle-option active" data-type="all">
            All Recipes
          </button>
          <button class="toggle-option" data-type="my-recipes">
            Added By Me
          </button>
        </div>
        <% } %>
      </div>
    </section>

    <!-- Recipes Section -->
    <section class="recipes-section">
      <div class="container">
        <!-- No Recipes Message (initially hidden, shown by JavaScript when needed) -->
        <div class="no-recipes-message hidden" id="no-recipes-message">
          <p id="no-recipes-text">No recipes available.</p>
        </div>

        <div class="recipes-grid" id="recipes-grid">
          <% if (recipes.length === 0) { %>
          <div class="no-recipes-message">
            <p>No recipes available.</p>
          </div>
          <% } else { %> <% recipes.forEach(recipe => { %>
          <div
            class="recipe-card"
            data-category="<%= recipe.cuisineId ? recipe.cuisineId.cuisineName.toLowerCase() : 'uncategorized' %>"
            data-author-id="<%= recipe.authorId ? recipe.authorId._id : '' %>"
          >
            <div
              class="recipe-image"
              data-image="<%= recipe.recipeImage || '/default-recipe.jpg' %>"
            ></div>
            <div class="recipe-content">
              <h3 class="recipe-title"><%= recipe.title %></h3>
              <div class="recipe-meta">
                <div>
                  Added By <%= recipe.authorId ? recipe.authorId.username :
                  'Unknown' %>
                </div>
                <div>
                  Added On <%= recipe.createdAt ?
                  recipe.createdAt.toDateString() : 'Unknown' %>
                </div>
                <div>
                  Cuisine: <%= recipe.cuisineId ? recipe.cuisineId.cuisineName :
                  'Uncategorized' %>
                </div>
              </div>
              <a href="/recipes/<%= recipe._id %>" class="view-recipe"
                >View Recipe</a
              >
            </div>
          </div>
          <% }) %> <% } %>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <a href="#top" class="back-to-top">â†‘</a>
        <p>&copy; All rights reserved Fresca 2025</p>
      </div>
    </footer>
  </body>
</html>
